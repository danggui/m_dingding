define(["View",getViewTemplatePath("changeHeadPortrait"),"UIToast","UILoading","ChangePasswordModel","MyProfileStore","LanguageStore","EnvStore"],function(a,b,c,d,e,f,g,h){var i=h.getInstance(),j=f.getInstance(),k=g.getInstance(),l="";return _.inherit(a,{onCreate:function(){this.$el.html(b),this.$("#headSettings-box").append(_.template(this.$("#headSettings").html())({lanStore:k.getAttr("language")}))},events:{"click #Photograph":"Photograph","click #AccesstoPhone":"AccesstoPhone","click #save_photo":"save_photo"},save_photo:function(){var a=this,b=j.getAttr("sessionid"),e=i.getAttr("envUrl");if(a.loading1||(a.loading1=new d({maskToHide:!0})),a.toast1||(a.toast1=new c({datamodel:{content:"content"},TIMERRES:!0})),""!=l){var f=encodeURI(e+"/micro/pa/saveEmployeePhoto;jsessionid="+b),g=when.defer(),h=new FileUploadOptions;h.fileKey="photo",h.fileName=l.substr(l.lastIndexOf("/")+1),h.mimeType="image/jpeg";var m=new FileTransfer;return a.loading1.show(),m.upload(l,f,function(b){a.loading1.hide(),a.toast1.showToast(k.getAttr("language").uploadWin),a.back(),$("#headPortrait").attr("src",JSON.parse(b.response).message)},function(){a.loading1.hide(),a.toast1.showToast(k.getAttr("language").uploadFail)},h),g.promise}a.toast1.showToast(k.getAttr("language").noPhoto)},Photograph:function(){var a=this;navigator.camera.getPicture(a.onPhotoUrlSuccess,a.onUrlFail,{quality:100,allowEdit:!0,destinationType:Camera.DestinationType.FILE_URI,targetWidth:150,targetHeight:150})},AccesstoPhone:function(){var a=this;navigator.camera.getPicture(a.onPhotoUrlSuccess,a.onUrlFail,{destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.PHOTOLIBRARY,allowEdit:!0,targetWidth:150,targetHeight:150,mediaType:Camera.MediaType.PICTURE})},onPhotoUrlSuccess:function(a){l=a.lastIndexOf("?")>0?a.substring(0,a.lastIndexOf("?")):a,$("#headPortrait-edit").attr("src",a)},onUrlFail:function(a){0},onPreShow:function(){this.turning()},onShow:function(){$("#headPortrait-edit").attr("src",localStorage.getItem("myInfoEditValue"))},onHide:function(){}})});