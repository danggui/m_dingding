define(["AbstractView",getViewTemplatePath("login"),"UIToast","LoginModel","MyProfileStore","EnvStore","UILoading","LanguageStore","VersionModel","UIArticle"],function(a,b,c,d,e,f,g,h,i,j){var k="1.0.0",l={versions:function(){var a=navigator.userAgent;navigator.appVersion;return{trident:a.indexOf("Trident")>-1,presto:a.indexOf("Presto")>-1,webKit:a.indexOf("AppleWebKit")>-1,gecko:a.indexOf("Gecko")>-1&&-1==a.indexOf("KHTML"),mobile:!!a.match(/AppleWebKit.*Mobile.*/),ios:!!a.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:a.indexOf("Android")>-1||a.indexOf("Linux")>-1,iPhone:a.indexOf("iPhone")>-1,iPad:a.indexOf("iPad")>-1,webApp:-1==a.indexOf("Safari"),weixin:a.indexOf("MicroMessenger")>-1,qq:" qq"==a.match(/\sQQ/i)}}(),language:(navigator.browserLanguage||navigator.language).toLowerCase()};localStorage.setItem("browser",JSON.stringify(l.versions));var m=f.getInstance(),n=i.getInstance(),o=d.getInstance(),p=e.getInstance();p.setAttr("sessionid","");var q=h.getInstance(),r="",s={WEB_URL_DEV:"http://192.168.101.126:8082",WEB_URL_T:"http://58.240.190.198:8142",WEB_URL_D:"http://120.27.43.83:8083",WEB_URL_W:"https://lite.cdpcloud.com",WEB_LUKE:"http://192.168.102.72:8080"};return m.setAttr("envUrl","http://101.230.3.6:8082"),_.inherit(a,{onCreate:function(){function a(){if("block"==$("#view_1").css("display")){this.toast1||(this.toast1=new c({datamodel:{content:"content"},TIMERRES:!0})),this.toast1.showToast(q.getAttr("language").quiteAppError),document.removeEventListener("backbutton",a,!1),document.addEventListener("backbutton",f,!1);var b=window.setInterval(function(){window.clearInterval(b),document.removeEventListener("backbutton",f,!1),document.addEventListener("backbutton",a,!1)},3e3)}else"block"==$("#view_6").css("display")||navigator.app.backHistory()}function d(){this.toast1||(this.toast1=new c({datamodel:{content:"content"},TIMERRES:!0})),this.toast1.showToast(q.getAttr("language").networkStates)}function e(){this.toast1||(this.toast1=new c({datamodel:{content:"content"},TIMERRES:!0})),this.toast1.showToast(q.getAttr("language").networkStates)}function f(){navigator.app.exitApp()}if(l.versions.android)var h="android";else var h="ios";n.execute(function(a,b,d,e){return this.toast1||(this.toast1=new c({datamodel:{content:"content"},TIMERRES:!0})),this.loading1||(this.loading1=new g({maskToHide:!0})),"0"==b.status?(this.toast1.showToast(b.message),this.loading1.hide(),!1):void(k!=b.data.version&&(this.groupSelectPolicy||(this.groupSelectPolicy=new j({datamodel:{title:q.getAttr("language").updatePop,btns:[{name:q.getAttr("language").cancel,className:"pop-box-btns-cancel"},{name:q.getAttr("language").confirm,className:"pop-box-btns-ok"}]},data:[],indexArr:[],changedArr:[],onOkAction:function(a){JSON.parse(localStorage.browser).ios?(navigator.app.loadUrl(encodeURI("itms-services://?action=download-manifest&url=https://www.cdpcloud.com/download/dev/microCloud.plist"),{openExternal:!0}),this.hide()):(navigator.app.loadUrl(encodeURI("http://58.240.190.198:8085/microCloud/APP/MicroCloud.apk"),{openExternal:!0}),this.hide())},onCancelAction:function(a){0,this.hide()}})),this.groupSelectPolicy.scrollWrapper[0].innerHTML=q.getAttr("language").UpgradeContent,this.groupSelectPolicy.show(),JSON.parse(localStorage.browser).ios&&($(".pop-box-btns-ok")[0].innerHTML='<a href="itms-services://?action=download-manifest&amp;url=https://www.cdpcloud.com/download/dev/microCloud.plist" style="color: #099fde">'+q.getAttr("language").confirm+"</a>"),b.data.must_upgrade&&$(".pop-box-btns-cancel").css("display","none")))},function(a){0},this,function(a){},{device:h}),this.$el.html(b);var i=navigator.appName;r=""==location.search?"Netscape"==i?navigator.language.toLowerCase().replace("-","_"):navigator.userLanguage.toLowerCase().replace("-","_"):location.search.split("?")[1].toLowerCase().replace("-","_"),"en_us"!=r&&"zh_cn"!=r&&(r="en_us"),$.ajax({type:"GET",url:"./fakedata/"+r+".json",dataType:"json",success:function(a){q.setAttr("language",a.data),this.$("#login").append(_.template(this.$("#login-language").html())({lanStore:q.getAttr("language")}))},error:function(a,b){0}}),document.addEventListener("deviceready",function(){document.addEventListener("offline",d,!1),document.addEventListener("online",e,!1),document.addEventListener("backbutton",a,!1)},!1)},events:{"focus input":function(a){$(a.target.parentNode.nextElementSibling).css("display","block")},"blur input":function(a){$(".clear-text").css("display","none")},"click #btn_enter":"checkValidate","click .clear-text":"clearText","click .language-settings-loging":"selectLanguage","click .forgetpwd":function(){this.forward("PwdProblem")},"click #remember":"rememberF"},rememberF:function(){$("#remember").toggleClass("mui-active"),$("#remember").children().toggleClass("mui-switch-active")},clearText:function(a){$(a.target.previousElementSibling).find("input")[0].value="",$(a.target.previousElementSibling).find("input").focus()},selectLanguage:function(a){var b=a.target.dataset.id;$(".language-settings-loging").removeClass("language-settings-selected"),$(a.target).addClass("language-settings-selected"),location.replace(window.location.origin+window.location.pathname+"?"+b)},checkValidate:function(a){a.stopPropagation();var b=$("#company").val().trim(),d=$("#username").val().trim(),e=$("#pwd").val().trim();try{var f=navigator.connection.type}catch(h){}if(this.toast1||(this.toast1=new c({datamodel:{content:"content"},TIMERRES:!0})),a.preventDefault(),""==b)return this.toast1.showToast(q.getAttr("language").loginTipsCompany),!1;if(""==d)return this.toast1.showToast(q.getAttr("language").loginTipsName),!1;if(""==e)return this.toast1.showToast(q.getAttr("language").loginTipsPassword),!1;if("none"==f)this.toast1.showToast(q.getAttr("language").networkStates);else{$("#remember")[0].getAttribute("class").split(" ")[1]&&"mui-active"==$("#remember")[0].getAttribute("class").split(" ")[1]?(window.localStorage.setItem("remember","true"),window.localStorage.setItem("company",b),window.localStorage.setItem("userName",d),window.localStorage.setItem("passWord",e)):(window.localStorage.setItem("remember",""),window.localStorage.setItem("company",""),window.localStorage.setItem("userName",""),window.localStorage.setItem("passWord",""));var i=b.substring(0,b.indexOf("#")+1).toLowerCase();"d#"==i?m.setAttr("envUrl",s.WEB_URL_DEV):"t#"==i?m.setAttr("envUrl",s.WEB_URL_T):"m#"==i?m.setAttr("envUrl",s.WEB_URL_D):"l#"==i?m.setAttr("envUrl",s.WEB_LUKE):m.setAttr("envUrl",s.WEB_URL_W),this.loading1||(this.loading1=new g({maskToHide:!0})),this.loading1.show(),o.execute(function(a,b,d,e){return"0"==b.status?(this.toast1.showToast(b.message),this.loading1.hide(),!1):(p.setAttr("sessionid",b.data.session_id),p.setAttr("myProfileStore",JSON.stringify(b.data)),b.data.reset_pwd?(this.toast1=new c({datamodel:{content:"content"},TIMERRES:!0}),this.toast1.showToast(q.getAttr("language").FirstLanding),this.forward("changePwd")):this.forward("MyProfile"),this.loading1.hide(),void 0)},function(a){0},this,function(a){},{client_code:b.substring(b.indexOf("#")+1),user_name:d,password:e,language:r})}},jsonpCallback:function(a){alert(a.message)},onPreShow:function(){this.turning()},onShow:function(){$("."+r).addClass("language-settings-selected")},onHide:function(){}})});